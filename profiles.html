<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profils PCM - Conseils de communication</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      color: #1d1d1f;
      line-height: 1.6;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      padding: 40px;
      margin-top: 20px;
    }

    h1 {
      text-align: center;
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 40px;
      background: linear-gradient(135deg, #007AFF, #5856D6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .profil {
      margin: 30px 0;
      padding: 32px;
      border-radius: 16px;
      background: #ffffff;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
      border: 1px solid rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .profil::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(135deg, #007AFF, #5856D6);
    }

    .profil:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 35px rgba(0, 0, 0, 0.12);
    }

    .profil h2 {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 20px;
      color: #1d1d1f;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .profil-icon {
      font-size: 2rem;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #007AFF, #5856D6);
      border-radius: 12px;
      color: white;
      font-weight: 600;
    }

    .profil ul {
      list-style: none;
      padding: 0;
    }

    .profil ul li {
      margin-bottom: 16px;
      padding: 16px;
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border-radius: 12px;
      border-left: 4px solid #007AFF;
      font-size: 1rem;
      line-height: 1.6;
    }

    .profil ul li strong {
      color: #007AFF;
      font-weight: 600;
      display: block;
      margin-bottom: 4px;
    }

    .back-link {
      text-align: center;
      margin-top: 60px;
    }

    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: linear-gradient(135deg, #007AFF, #5856D6);
      color: white;
      text-decoration: none;
      padding: 16px 24px;
      border-radius: 12px;
      font-weight: 600;
      font-size: 1rem;
      transition: all 0.3s ease;
      box-shadow: 0 8px 20px rgba(0, 122, 255, 0.3);
    }

    .back-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 30px rgba(0, 122, 255, 0.4);
    }

    .back-btn:active {
      transform: translateY(0);
    }

    .share-section {
      text-align: center;
      margin: 40px 0;
      padding: 30px;
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border-radius: 16px;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .share-section h3 {
      font-size: 1.3rem;
      font-weight: 600;
      margin-bottom: 20px;
      color: #1d1d1f;
    }

    .copy-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 16px 24px;
      border-radius: 12px;
      font-weight: 600;
      font-size: 1rem;
      text-decoration: none;
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
      background: linear-gradient(135deg, #007AFF, #5856D6);
      color: white;
      box-shadow: 0 8px 20px rgba(0, 122, 255, 0.3);
    }

    .copy-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 30px rgba(0, 122, 255, 0.4);
    }

    .copy-btn:active {
      transform: translateY(0);
    }

    .copy-feedback {
      color: #007AFF;
      font-weight: 600;
      font-size: 0.9rem;
      margin-top: 15px;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .copy-feedback.show {
      opacity: 1;
    }

    .export-btn {
      background: linear-gradient(135deg, #34C759, #30D158);
      color: white;
      border: none;
      padding: 16px 24px;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      margin-top: 20px;
    }

    .export-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(52, 199, 89, 0.4);
    }

    .export-btn:active {
      transform: translateY(0);
    }

    .export-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .image-preview {
      margin-top: 30px;
      text-align: center;
      padding: 20px;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 16px;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .image-preview img {
      max-width: 100%;
      border-radius: 12px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      border: 2px solid rgba(0, 0, 0, 0.05);
    }

    .download-link {
      display: inline-block;
      margin-top: 15px;
      padding: 12px 24px;
      background: linear-gradient(135deg, #007AFF, #5856D6);
      color: white;
      text-decoration: none;
      border-radius: 10px;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .download-link:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 122, 255, 0.4);
    }

    @media (max-width: 768px) {
      .container {
        padding: 20px;
        margin: 10px;
      }
      
      h1 {
        font-size: 2rem;
      }
      
      .profil {
        padding: 24px;
      }
      
      .profil h2 {
        font-size: 1.5rem;
        flex-direction: column;
        text-align: center;
        gap: 8px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Ton profil PCM</h1>
    <div id="profile-content"></div>
    
    <div class="share-section">
      <h3>Partager mon profil PCM</h3>
      <button class="copy-btn" onclick="copyToClipboard()">
        üìã Copier le lien
      </button>
      <div class="copy-feedback" id="copyFeedback">Lien copi√© !</div>
      
      <button class="export-btn" onclick="exportProfileImage()">
        üì∏ Exporter en image
      </button>
    </div>
    
    <div class="image-preview hidden" id="imagePreview"></div>
    
    <div class="back-link">
      <a href="index.html" class="back-btn">‚Üê Revenir au test</a>
    </div>
  </div>

  <script>
    const profiles = [
      {
        name: 'Penseur¬∑se',
        icon: 'üß†',
        advice: [
          { title: '√Ä faire', content: '√™tre structur√©¬∑e, logique, pr√©cis¬∑e' },
          { title: 'Utilise', content: 'faits, proc√©dures, explications claires' },
          { title: '√âvite', content: 'l\'impr√©cision, l\'improvisation, les d√©bordements √©motionnels' }
        ]
      },
      {
        name: 'Empathique',
        icon: '‚ù§Ô∏è',
        advice: [
          { title: '√Ä faire', content: '√™tre chaleureux¬∑se, humain¬∑e, √† l\'√©coute' },
          { title: 'Utilise', content: 'reconnaissance, √©motions, attention √† l\'autre' },
          { title: '√âvite', content: 'le ton froid, distant ou impersonnel' }
        ]
      },
      {
        name: 'Rebelle',
        icon: 'üåü',
        advice: [
          { title: '√Ä faire', content: '√™tre l√©ger¬∑e, spontan√©¬∑e, ludique' },
          { title: 'Utilise', content: 'humour, cr√©ativit√©, interaction dynamique' },
          { title: '√âvite', content: 'la rigidit√©, les r√®gles trop strictes' }
        ]
      },
      {
        name: 'Promoteur¬∑rice',
        icon: 'üì¢',
        advice: [
          { title: '√Ä faire', content: '√™tre direct¬∑e, rapide, ax√©¬∑e sur les r√©sultats' },
          { title: 'Utilise', content: 'd√©fis, autonomie, action' },
          { title: '√âvite', content: 'les d√©tails excessifs, les lenteurs, le contr√¥le excessif' }
        ]
      },
      {
        name: 'R√™veur¬∑se',
        icon: 'üßò',
        advice: [
          { title: '√Ä faire', content: 'donner de l\'espace, √™tre calme et structur√©¬∑e' },
          { title: 'Utilise', content: 'consignes claires, environnement paisible' },
          { title: '√âvite', content: 'la pr√©cipitation, la surcharge de stimulations' }
        ]
      },
      {
        name: 'Pers√©v√©rant¬∑e',
        icon: 'üß≠',
        advice: [
          { title: '√Ä faire', content: '√™tre coh√©rent¬∑e, engag√©¬∑e, respectueux¬∑se des convictions' },
          { title: 'Utilise', content: 'valeurs, justice, reconnaissance de l\'engagement' },
          { title: '√âvite', content: 'l\'incoh√©rence, le d√©sint√©r√™t apparent' }
        ]
      }
    ];

    // Get URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const profileIndex = urlParams.get('profile');
    const secondaryIndex = urlParams.get('secondary');

    const profileContent = document.getElementById('profile-content');

    if (profileIndex !== null) {
      const mainProfile = profiles[parseInt(profileIndex)];
      const secondaryProfile = secondaryIndex !== null ? profiles[parseInt(secondaryIndex)] : null;

      // Display main profile
      let html = `
        <div class="profil" style="border: 3px solid #007AFF;">
          <h2>
            <div class="profil-icon">${mainProfile.icon}</div>
            ${mainProfile.name} - Ton profil dominant
          </h2>
          <ul>`;
      
      mainProfile.advice.forEach(item => {
        html += `<li><strong>${item.title} :</strong> ${item.content}</li>`;
      });
      
      html += `</ul></div>`;

      // Display secondary profile if available
      if (secondaryProfile) {
        html += `
          <div class="profil" style="border: 3px solid #5856D6; margin-top: 30px;">
            <h2>
              <div class="profil-icon">${secondaryProfile.icon}</div>
              ${secondaryProfile.name} - Ton profil secondaire
            </h2>
            <ul>`;
        
        secondaryProfile.advice.forEach(item => {
          html += `<li><strong>${item.title} :</strong> ${item.content}</li>`;
        });
        
        html += `</ul></div>`;
      }

      profileContent.innerHTML = html;
    } else {
      // If no profile parameter, show all profiles (fallback)
      let html = '<h2 style="text-align: center; margin-bottom: 30px;">Tous les profils PCM</h2>';
      profiles.forEach(profile => {
        html += `
          <div class="profil">
            <h2>
              <div class="profil-icon">${profile.icon}</div>
              ${profile.name}
            </h2>
            <ul>`;
        
        profile.advice.forEach(item => {
          html += `<li><strong>${item.title} :</strong> ${item.content}</li>`;
        });
        
        html += `</ul></div>`;
      });
             profileContent.innerHTML = html;
     }

     // Copy to clipboard functionality
     function copyToClipboard() {
       const currentUrl = window.location.href;
       navigator.clipboard.writeText(currentUrl).then(() => {
         const feedback = document.getElementById('copyFeedback');
         feedback.classList.add('show');
         setTimeout(() => {
           feedback.classList.remove('show');
         }, 2000);
       }).catch(err => {
         console.error('Failed to copy: ', err);
         // Fallback for older browsers
         const textArea = document.createElement('textarea');
         textArea.value = currentUrl;
         document.body.appendChild(textArea);
         textArea.select();
         document.execCommand('copy');
         document.body.removeChild(textArea);
         
         const feedback = document.getElementById('copyFeedback');
         feedback.classList.add('show');
         setTimeout(() => {
           feedback.classList.remove('show');
         }, 2000);
       });
     }

     // Export profile as PNG image
     function exportProfileImage() {
       const profileContent = document.getElementById('profile-content');
       const imagePreview = document.getElementById('imagePreview');
       const exportBtn = document.querySelector('.export-btn');
       
       // Show loading state
       const originalText = exportBtn.innerHTML;
       exportBtn.innerHTML = 'üîÑ G√©n√©ration...';
       exportBtn.disabled = true;

       // Create a temporary container for better image capture
       const tempContainer = document.createElement('div');
       tempContainer.style.cssText = `
         background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
         padding: 40px;
         border-radius: 20px;
         max-width: 800px;
         margin: 0 auto;
         font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
         min-height: 100vh;
       `;
       
       // Add title
       const title = document.createElement('h1');
       title.innerHTML = 'Mon Profil PCM - D√©tails';
       title.style.cssText = `
         text-align: center;
         font-size: 2.5rem;
         font-weight: 700;
         margin-bottom: 40px;
         background: linear-gradient(135deg, #007AFF, #5856D6);
         -webkit-background-clip: text;
         -webkit-text-fill-color: transparent;
         background-clip: text;
       `;
       
       // Clone the profile content
       const contentClone = profileContent.cloneNode(true);
       
       // Style the cloned content
       const profileCards = contentClone.querySelectorAll('.profil');
       profileCards.forEach(card => {
         card.style.cssText = `
           margin: 30px 0;
           padding: 32px;
           border-radius: 16px;
           background: #ffffff;
           box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
           border: 1px solid rgba(0, 0, 0, 0.05);
           transition: all 0.3s ease;
           position: relative;
           overflow: hidden;
         `;
         
         // Add gradient border
         card.style.setProperty('--gradient-border', 'linear-gradient(135deg, #007AFF, #5856D6)');
         card.style.border = '3px solid transparent';
         card.style.background = 'linear-gradient(white, white) padding-box, var(--gradient-border) border-box';
       });
       
       tempContainer.appendChild(title);
       tempContainer.appendChild(contentClone);
       document.body.appendChild(tempContainer);

       // Capture the image
       html2canvas(tempContainer, {
         backgroundColor: null,
         scale: 2,
         useCORS: true,
         allowTaint: true,
         width: 800,
         height: tempContainer.offsetHeight,
         scrollY: 0,
         scrollX: 0
       }).then(canvas => {
         // Remove temporary container
         document.body.removeChild(tempContainer);
         
         // Convert to blob and create download link
         canvas.toBlob(function(blob) {
           const url = URL.createObjectURL(blob);
           
           // Get profile name for filename
           const profileName = getProfileName();
           const filename = `profil-pcm-${profileName.toLowerCase().replace(/[^a-z0-9]/g, '-')}.png`;
           
           // Show preview and download link
           imagePreview.classList.remove('hidden');
           imagePreview.innerHTML = `
             <img src="${url}" alt="Profil PCM d√©taill√©" />
             <br>
             <a href="${url}" download="${filename}" class="download-link">
               üíæ T√©l√©charger l'image
             </a>
           `;
           
           // Reset button
           exportBtn.innerHTML = originalText;
           exportBtn.disabled = false;
           
           // Scroll to preview
           imagePreview.scrollIntoView({ behavior: 'smooth' });
         }, 'image/png');
       }).catch(error => {
         console.error('Error generating image:', error);
         exportBtn.innerHTML = originalText;
         exportBtn.disabled = false;
         alert('Erreur lors de la g√©n√©ration de l\'image. Veuillez r√©essayer.');
       });
     }

     // Helper function to get profile name for filename
     function getProfileName() {
       const urlParams = new URLSearchParams(window.location.search);
       const profileIndex = urlParams.get('profile');
       if (profileIndex !== null) {
         const profile = profiles[parseInt(profileIndex)];
         return profile.name;
       }
       return 'complet';
     }
   </script>
</body>
</html>
